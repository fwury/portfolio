<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>John Derham</title>

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="favicon.png">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000"
        rel="stylesheet">

    <!-- Custom CSS -->
    <style>
        body {
            background-color: #000;
            color: #fff;
            font-family: 'DM Sans', sans-serif;
            margin: 0;
        }

        /* --- Hero & Nav Updates --- */
        #hero-header {
            position: relative;
            width: 100%;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            cursor: pointer;
            /* Indicates the hero is clickable */
        }

        #hero-video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 0;
        }

        /* --- New Hero Logos Styling --- */
        .hero-logos {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 4rem;
            z-index: 2;
            /* Sits above video, below Nav */
            pointer-events: none;
            /* Allows click to pass through to the header container */
            width: 100%;
            padding: 0 1rem;
        }

        /* Re-enable pointer events for the logo links */
        .hero-logos a {
            pointer-events: auto;
        }

        .hero-logos img {
            /* Removed generic height to allow individual sizing below */
            width: auto;
            object-fit: contain;
            filter: brightness(0) invert(1);
            /* Ensures logos are white if source isn't */
            transition: opacity 0.3s ease;
        }

        /* INDIVIDUAL LOGO SIZING */
        #logo-storytolds {
            height: 18px;
        }

        #logo-redbull {
            height: 42px;
        }

        #logo-ditch {
            height: 36px;
        }

        .hero-logos a:hover img {
            opacity: 0.7;
        }

        @media (max-width: 768px) {
            .hero-logos {
                gap: 2rem;
                flex-wrap: wrap;
            }

            /* Mobile Logo Sizing */
            #logo-storytolds {
                height: 14px;
            }

            #logo-redbull {
                height: 32px;
            }

            #logo-ditch {
                height: 26px;
            }
        }

        .navbar {
            padding-top: 4rem;
            padding-bottom: 4rem;
            position: relative;
            z-index: 10;
            width: 100%;
            pointer-events: none;
            /* Disable pointer events on wrapper */
        }

        /* Re-enable pointer events for actual interactive nav elements */
        .navbar .container-fluid>* {
            pointer-events: auto;
        }

        .navbar-brand {
            transition: opacity 0.3s ease;
            display: flex;
            align-items: center;
        }

        .navbar-brand img {
            max-height: 50px;
            width: auto;
        }

        .navbar-brand:hover {
            opacity: 0.7;
        }

        /* --- End Hero Updates --- */

        .content-wrapper {
            padding-left: 5rem;
            padding-right: 5rem;
        }

        @media (max-width: 768px) {
            .content-wrapper {
                padding-left: 1rem;
                padding-right: 1rem;
            }
        }

        /* --- Booster Section Styling --- */
        #booster-section {
            background-color: #FFDE21;
            padding-top: 5rem;
            padding-bottom: 5rem;
            width: 100%;
        }

        /* Spacing between the dynamic grid and the new static row */
        .booster-extras {
            margin-top: 1.5rem;
            display: flex;
            /* Use Flexbox for equal height */
            gap: 1.5rem;
            /* Match grid gap */
            width: 100%;
            /* 
               This aspect ratio sets the height of the row relative to its width.
               21/9 creates a nice wide rectangular block that accommodates 
               both the portrait and landscape images well.
            */
            aspect-ratio: 21 / 9;
        }

        /* --- NASA Section Styling --- */
        #nasa-section {
            background-color: #0B3D91;
            /* Official NASA Blue */
            padding-top: 5rem;
            padding-bottom: 5rem;
            width: 100%;
        }

        /* --- Custom Contact Styling --- */
        .contact-button {
            color: #fff;
            font-family: 'DM Sans', sans-serif;
            text-decoration: none;
            background: none;
            border: none;
            font-size: 1rem;
            letter-spacing: 1px;
            padding: .5rem 1rem;
            transition: opacity 0.3s ease;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
        }

        .contact-button:hover {
            opacity: 0.7;
        }

        .dropdown-toggle::after {
            vertical-align: 0.15em;
        }

        .dropdown-menu {
            background-color: #111;
            border: 1px solid #333;
            padding: 0.5rem;
            z-index: 1000;
        }

        .dropdown-item {
            color: #ccc;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            transition: background-color 0.3s ease;
        }

        .dropdown-item img {
            width: 16px;
            height: 16px;
        }

        .dropdown-item:hover,
        .dropdown-item:focus {
            color: #fff;
            background-color: #222;
        }

        #contactModal {
            display: none;
            position: fixed;
            z-index: 1100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 2rem;
        }

        #contactModal a {
            color: #fff;
            text-decoration: none;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: opacity 0.3s ease;
        }

        #contactModal a:hover {
            opacity: 0.7;
        }

        #contactModal img {
            width: 24px;
            height: 24px;
        }

        .portfolio-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
        }

        /* New Single Column Grid for NASA Section */
        .portfolio-grid.single-col {
            grid-template-columns: 1fr;
        }

        @media (max-width: 768px) {
            .portfolio-grid {
                grid-template-columns: 1fr;
            }

            /* Mobile styles for the extras row */
            .booster-extras {
                flex-direction: column;
                aspect-ratio: auto;
                /* Allow auto height for stacking */
            }

            .static-left,
            .static-right {
                width: 100% !important;
                height: auto;
                aspect-ratio: 16 / 9;
                /* Revert to standard rectangle on mobile */
            }
        }

        .portfolio-item {
            position: relative;
            cursor: pointer;
        }

        .portfolio-image {
            aspect-ratio: 16 / 9;
            background-size: cover;
            background-position: center;
        }

        /* For Booster Section Dynamic Images */
        .booster-image {
            aspect-ratio: 1 / 1;
            background-size: cover;
            background-position: center;
        }

        /* For Booster Section Static Items (Img or Video) */
        .static-item {
            background-size: cover;
            background-position: center;
            height: 100%;
            /* Force fill height of the flex row */
            /* Handles video scaling correctly to mimic bg-size: cover */
            object-fit: cover;
            border: none;
        }

        /* Width proportions to match the visual reference */
        .static-left {
            width: 38%;
        }

        .static-right {
            width: 62%;
        }

        .portfolio-item .overlay {
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            height: 100%;
            width: 100%;
            opacity: 0;
            transition: .3s ease;
            background-color: rgba(0, 0, 0, 0.5);
            /* Increased opacity for visibility on yellow bg */
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        @media (hover: hover) {
            .portfolio-item:hover .overlay {
                opacity: 1;
            }
        }

        .project-name {
            font-family: 'DM Sans', sans-serif;
            color: white;
            font-size: 1.25rem;
            padding: 1rem;
        }

        /* --- Views Icon Inline Style --- */
        .views-icon {
            height: 1em;
            /* Matches current font size */
            width: auto;
            vertical-align: middle;
            margin-left: 4px;
            padding-bottom: 2px;
            /* Slight visual adjustment */
            filter: brightness(0) invert(1);
            /* Ensure it is white like the text */
        }

        /* --- Modal Styling --- */
        .modal {
            display: none;
            position: fixed;
            z-index: 1050;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: rgba(0, 0, 0, 0.85);
            align-items: center;
            justify-content: center;
        }

        .modal.is-open {
            display: flex;
        }

        .modal-content {
            position: relative;
            width: 90%;
            max-width: 1200px;
            max-height: 80vh;
            display: flex;
            background-color: transparent;
            border: none;
            pointer-events: none;
        }

        .carousel-container,
        .description-container {
            pointer-events: auto;
        }

        .modal-body {
            display: flex;
            width: 100%;
            height: 100%;
            padding: 0;
            align-items: flex-start;
        }

        .close-button {
            position: absolute;
            top: 2rem;
            right: 2rem;
            background: none;
            border: none;
            padding: 0;
            cursor: pointer;
            z-index: 1060;
        }

        .close-button img {
            width: 40px;
            height: 40px;
            display: block;
            transition: opacity 0.3s ease;
        }

        .close-button:hover img {
            opacity: 0.7;
        }

        .carousel-container {
            width: 75%;
            position: relative;
            aspect-ratio: 16 / 9;
        }

        .social-media-icon {
            width: 30px;
            height: 30px;
        }

        #projectCarousel,
        .carousel-inner,
        .carousel-item {
            height: 100%;
        }

        iframe,
        img.carousel-img {
            width: 100%;
            height: 100%;
            border: none;
        }

        .description-container {
            width: 25%;
            max-height: 80vh;
            padding: 0 2rem 1rem 2rem;
            overflow-y: auto;
        }

        /* --- Hero Mode Modal Styles (No text, full width) --- */
        .modal.hero-mode .description-container {
            display: none !important;
        }

        .modal.hero-mode .carousel-container {
            width: 100% !important;
        }

        #projectTitle {
            font-family: 'DM Sans', sans-serif;
            font-size: 1.8rem;
            font-weight: bold;
            padding-bottom: 0.75rem;
            margin-top: 0;
            margin-bottom: 1rem;
            border-bottom: 1px solid #555;
        }

        #projectDescription {
            font-size: 0.9rem;
            line-height: 1.7;
            color: #ccc;
        }

        .carousel-control-prev,
        .carousel-control-next {
            width: 5%;
            height: 50%;
            top: 25%;
        }

        .carousel-indicators {
            position: absolute;
            bottom: -50px;
        }

        @media (max-width: 992px) {
            .modal-body {
                flex-direction: column;
                align-items: center;
                justify-content: center;
            }

            .carousel-container {
                width: 100%;
            }

            .description-container {
                display: none;
            }

            .carousel-indicators {
                bottom: -40px;
            }

            .close-button {
                top: 1rem;
                right: 1rem;
            }
        }

        .scroll-prompt {
            position: fixed;
            z-index: 9999999;
            top: 90%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            text-align: center;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            pointer-events: none;
            /* Let scroll prompt not block clicks */
        }

        .scroll-prompt span {
            font-family: 'DM Sans', sans-serif;
            font-size: 1rem;
            letter-spacing: 1px;
            color: #fff;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
        }

        .scroll-prompt img {
            width: 30px;
            height: auto;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.8));
            animation: float 3s ease-in-out infinite;
        }

        .scroll-prompt.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        @keyframes float {
            0% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(5px);
            }

            100% {
                transform: translateY(0);
            }
        }
    </style>
</head>

<body>

    <!-- Header Section with Video and Nav -->
    <header id="hero-header">
        <!-- Background Video -->
        <video id="hero-video" autoplay loop muted playsinline>
            <source src="img/reel.mp4" type="video/mp4">
        </video>

        <!-- Centered Logos Overlay -->
        <div class="hero-logos">
            <a href="https://storytolds.co/" target="_blank"><img id="logo-storytolds" src="img/storytolds.png"
                    alt="Storytolds"></a>
            <a href="https://redbullrecords.com/" target="_blank"><img id="logo-redbull" src="img/redbull.png"
                    alt="Red Bull Records"></a>
            <a href="https://www.instagram.com/ditch/" target="_blank"><img id="logo-ditch" src="img/ditch.png"
                    alt="Ditch"></a>
        </div>

        <!-- Navigation -->
        <nav class="navbar navbar-dark bg-transparent">
            <div class="container-fluid content-wrapper">
                <!-- Logo Image -->
                <a class="navbar-brand" href="#">
                    <img src="img/logo.png" alt="John Derham">
                </a>

                <!-- Desktop Dropdown -->
                <div class="dropdown d-none d-lg-block">
                    <button class="btn dropdown-toggle contact-button" type="button" id="contactDropdown"
                        data-bs-toggle="dropdown" aria-expanded="false">
                        CONTACT ME
                    </button>
                    <ul class="dropdown-menu dropdown-menu-dark dropdown-menu-end" aria-labelledby="contactDropdown">
                        <li>
                            <a class="dropdown-item" href="https://www.instagram.com/johndrhm" target="_blank">
                                <img src="img/instagram.png" alt="Instagram">
                                <span>Instagram</span>
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="https://www.linkedin.com/in/john-derham-426398292/"
                                target="_blank">
                                <img src="img/linkedin.png" alt="LinkedIn">
                                <span>LinkedIn</span>
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="mailto:johnderhamtoronto@gmail.com">
                                <img src="img/email.png" alt="Email">
                                <span>johnderhamtoronto@gmail.com</span>
                            </a>
                        </li>
                    </ul>
                </div>

                <!-- Mobile Contact Button -->
                <button id="mobileContactButton" class="btn contact-button d-lg-none" type="button">
                    CONTACT ME
                </button>

                <!-- Scroll Prompt -->
                <div id="scrollPrompt" class="scroll-prompt">
                    <!-- <span>Scroll to see more work</span> -->
                    <img src="img/arrow.png" alt="Scroll Down">
                </div>
            </div>
        </nav>
    </header>

    <!-- Booster Juice Section -->
    <section id="booster-section">
        <div class="content-wrapper">
            <!-- Dynamic Booster Items (Top Row) -->
            <div id="booster-grid" class="portfolio-grid">
                <!-- JS will inject items here -->
            </div>

            <!-- Static Booster Items (Bottom Row) -->
            <div class="booster-extras">
                <div class="static-item static-left" style="background-image: url('img/booster-store.jpg');"></div>
                <video class="static-item static-right" autoplay loop muted playsinline>
                    <source src="img/booster-eatons.mp4" type="video/mp4">
                </video>
            </div>
        </div>
    </section>

    <!-- NASA Section -->
    <section id="nasa-section">
        <div class="content-wrapper">
            <div id="nasa-grid" class="portfolio-grid single-col">
                <!-- NASA items will be injected here -->
            </div>
        </div>
    </section>

    <main class="content-wrapper mb-5 mt-5" style="padding-top: 3rem;">
        <div id="portfolio-grid" class="portfolio-grid">
            <!-- Main Portfolio items will be injected here -->
        </div>
    </main>

    <!-- Project Viewer Modal -->
    <div id="projectModal" class="modal">
        <button id="closeProjectModalButton" class="close-button">
            <img src="img/x.png" alt="Close">
        </button>
        <div class="modal-content">
            <div class="modal-body">
                <div class="carousel-container">
                    <div id="projectCarousel" class="carousel slide h-100" data-bs-interval="false">
                        <div class="carousel-inner h-100">
                            <!-- Carousel items will be injected here -->
                        </div>
                        <button class="carousel-control-prev" type="button" data-bs-target="#projectCarousel"
                            data-bs-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Previous</span>
                        </button>
                        <button class="carousel-control-next" type="button" data-bs-target="#projectCarousel"
                            data-bs-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Next</span>
                        </button>
                        <div class="carousel-indicators">
                            <!-- Indicators will be injected here -->
                        </div>
                    </div>
                </div>
                <div class="description-container">
                    <h3 id="projectTitle"></h3>
                    <p id="projectDescription" style="white-space: pre-wrap;"></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Contact Modal -->
    <div id="contactModal">
        <button id="closeContactModalButton" class="close-button">
            <img src="img/x.png" alt="Close">
        </button>
        <a href="https://www.instagram.com/johndrhm" target="_blank">
            <img src="img/instagram.png" alt="Instagram">
            <span>Instagram</span>
        </a>
        <a href="https://www.linkedin.com/in/john-derham-426398292/" target="_blank">
            <img src="img/linkedin.png" alt="LinkedIn">
            <span>LinkedIn</span>
        </a>
        <a href="mailto:johnderhamtoronto@gmail.com">
            <img src="img/email.png" alt="Email">
            <span>johnderhamtoronto@gmail.com</span>
        </a>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

    <script>
        // Scroll Prompt Logic
        const scrollPrompt = document.getElementById('scrollPrompt');
        const heroHeader = document.getElementById('hero-header');

        window.addEventListener('scroll', function () {
            // If user scrolls down, hide the prompt
            if (window.scrollY > 20) {
                scrollPrompt.classList.add('hidden');
            }
        });

        document.addEventListener('DOMContentLoaded', function () {
            // Project Modal Elements
            const portfolioGrid = document.getElementById('portfolio-grid');
            const boosterGrid = document.getElementById('booster-grid');
            const nasaGrid = document.getElementById('nasa-grid');
            const projectModal = document.getElementById('projectModal');
            const closeProjectModalButton = document.getElementById('closeProjectModalButton');
            const projectTitle = document.getElementById('projectTitle');
            const projectDescription = document.getElementById('projectDescription');
            const carouselInner = document.querySelector('#projectCarousel .carousel-inner');
            const carouselIndicators = document.querySelector('#projectCarousel .carousel-indicators');
            const projectCarouselElement = document.getElementById('projectCarousel');
            const carousel = bootstrap.Carousel.getOrCreateInstance(projectCarouselElement);

            // Contact Modal Elements
            const contactModal = document.getElementById('contactModal');
            const mobileContactButton = document.getElementById('mobileContactButton');
            const closeContactModalButton = document.getElementById('closeContactModalButton');

            // Data Stores
            let mainProjectsData = [];
            let boosterProjectsData = [];
            let nasaProjectsData = [];

            // Modal Context State
            let currentProjectIndex = -1;
            let currentDataSource = 'main'; // 'main', 'booster', or 'nasa'

            // --- Project Data Handling ---
            function parseProjectsTxt(text) {
                const projects = [];
                const projectBlocks = text.split(/^\s*---\s*$/m).filter(block => block.trim() !== '');

                projectBlocks.forEach(block => {
                    const lines = block.trim().split('\n');
                    const project = { name: '', hoverText: '', thumbnail: '', vimeo_links: [], description: '' };
                    let currentKey = null;
                    let descriptionLines = [];
                    lines.forEach(line => {
                        const nameMatch = line.match(/^name:\s*(.*)/);
                        const hoverTextMatch = line.match(/^hover_text:\s*(.*)/);
                        const thumbnailMatch = line.match(/^thumbnail:\s*(.*)/);
                        const vimeoMatch = line.match(/^vimeo_links:/);
                        const descriptionMatch = line.match(/^description:/);

                        if (nameMatch) { project.name = nameMatch[1].trim(); currentKey = null; }
                        else if (hoverTextMatch) { project.hoverText = hoverTextMatch[1].trim(); currentKey = null; }
                        else if (thumbnailMatch) { project.thumbnail = thumbnailMatch[1].trim(); currentKey = null; }
                        else if (vimeoMatch) { currentKey = 'vimeo_links'; }
                        else if (descriptionMatch) { currentKey = 'description'; }
                        else if (currentKey) {
                            if (currentKey === 'vimeo_links' && line.trim()) { project.vimeo_links.push(line.trim()); }
                            else if (currentKey === 'description') { descriptionLines.push(line); }
                        }
                    });
                    project.description = descriptionLines.join('\n');
                    projects.push(project);
                });
                return projects;
            }

            async function loadMainProjects() {
                try {
                    const response = await fetch('projects.txt');
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    const textData = await response.text();
                    mainProjectsData = parseProjectsTxt(textData);
                    renderPortfolioGrid(mainProjectsData, portfolioGrid, 'portfolio-image', 'main');
                } catch (error) {
                    console.error("Could not load or parse projects.txt:", error);
                }
            }

            async function loadBoosterProjects() {
                try {
                    const response = await fetch('booster-juice.txt');
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    const textData = await response.text();
                    boosterProjectsData = parseProjectsTxt(textData);
                    // Render to booster grid, use 'booster-image' class (1:1), source = 'booster'
                    renderPortfolioGrid(boosterProjectsData, boosterGrid, 'booster-image', 'booster');
                } catch (error) {
                    console.error("Could not load or parse booster-juice.txt:", error);
                }
            }

            async function loadNasaProjects() {
                try {
                    const response = await fetch('nasa.txt');
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    const textData = await response.text();
                    nasaProjectsData = parseProjectsTxt(textData);
                    // Render to nasa grid, use 'portfolio-image' class (16:9), source = 'nasa'
                    renderPortfolioGrid(nasaProjectsData, nasaGrid, 'portfolio-image', 'nasa');
                } catch (error) {
                    console.error("Could not load or parse nasa.txt:", error);
                }
            }

            // Load all datasets
            loadMainProjects();
            loadBoosterProjects();
            loadNasaProjects();

            // --- UI Rendering ---
            // Updated to be reusable for all grids
            function renderPortfolioGrid(projects, gridElement, imageClass, source) {
                gridElement.innerHTML = '';
                projects.forEach((project, index) => {
                    const item = document.createElement('div');
                    item.className = 'portfolio-item';
                    item.dataset.index = index;

                    // Use hover_text if available, fallback to name
                    let hoverDisplay = project.hoverText || project.name;

                    // Replace "views" with image icon
                    hoverDisplay = hoverDisplay.replace(/views/gi, '<img src="img/views.png" class="views-icon" alt="views">');

                    item.innerHTML = `<div class="${imageClass}" style="background-image: url('${project.thumbnail}')"></div><div class="overlay"><div class="project-name">${hoverDisplay}</div></div>`;
                    item.addEventListener('click', () => openProjectModal(index, source));
                    gridElement.appendChild(item);
                });
            }

            // --- Modal Logic ---
            function openProjectModal(index, source) {
                currentProjectIndex = index;
                currentDataSource = source;

                // Determine which array to pull data from
                let activeData;
                if (source === 'booster') {
                    activeData = boosterProjectsData;
                } else if (source === 'nasa') {
                    activeData = nasaProjectsData;
                } else {
                    activeData = mainProjectsData;
                }

                const project = activeData[index];

                // Ensure text is visible for normal projects
                projectModal.classList.remove('hero-mode');

                projectTitle.textContent = project.name;
                projectDescription.textContent = project.description;
                carouselInner.innerHTML = '';
                carouselIndicators.innerHTML = '';

                project.vimeo_links.forEach((link, i) => {
                    const carouselItem = document.createElement('div');
                    carouselItem.className = `carousel-item ${i === 0 ? 'active' : ''}`;

                    // Check if link ends with an image extension
                    const isImage = link.match(/\.(jpeg|jpg|gif|png|webp)$/i);

                    if (isImage) {
                        carouselItem.innerHTML = `<img src="${link}" class="d-block w-100 h-100" style="object-fit: contain;" alt="Project Image">`;
                    } else {
                        carouselItem.innerHTML = `<iframe src="${link}" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen></iframe>`;
                    }

                    carouselInner.appendChild(carouselItem);

                    const indicator = document.createElement('button');
                    indicator.type = 'button';
                    indicator.dataset.bsTarget = '#projectCarousel';
                    indicator.dataset.bsSlideTo = i;
                    if (i === 0) indicator.classList.add('active');
                    carouselIndicators.appendChild(indicator);
                });
                carousel.to(0);
                projectModal.classList.add('is-open');
            }

            // Function to open Hero Reel
            function openHeroReel() {
                currentProjectIndex = -1; // No index in the grid
                currentDataSource = 'hero';

                // Set Modal to Hero Mode
                projectModal.classList.add('hero-mode');

                carouselInner.innerHTML = '';
                carouselIndicators.innerHTML = '';

                const reelLink = "https://player.vimeo.com/video/1149996889";

                const carouselItem = document.createElement('div');
                carouselItem.className = 'carousel-item active';
                carouselItem.innerHTML = `<iframe src="${reelLink}" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen></iframe>`;
                carouselInner.appendChild(carouselItem);

                projectModal.classList.add('is-open');
            }

            function closeProjectModal() {
                projectModal.classList.remove('is-open');

                // Completely clear the HTML content to destroy iframes and stop sound instantly
                carouselInner.innerHTML = '';
                carouselIndicators.innerHTML = '';

                // Remove hero mode class for safety
                setTimeout(() => {
                    projectModal.classList.remove('hero-mode');
                }, 300);
            }

            // Event Listeners for Project Modal
            closeProjectModalButton.addEventListener('click', closeProjectModal);
            projectModal.addEventListener('click', function (event) {
                if (event.target === projectModal) {
                    closeProjectModal();
                }
            });

            // Event Listener for Hero Click
            heroHeader.addEventListener('click', function (e) {
                // Check if click was on a link or button
                if (e.target.closest('a') || e.target.closest('button')) {
                    return;
                }
                openHeroReel();
            });

            // Event Listeners for Contact Modal
            mobileContactButton.addEventListener('click', () => { contactModal.style.display = 'flex'; });
            closeContactModalButton.addEventListener('click', () => { contactModal.style.display = 'none'; });

            // Keyboard navigation
            document.addEventListener('keydown', function (event) {
                if (projectModal.classList.contains('is-open')) {
                    if (currentDataSource === 'hero') {
                        if (event.key === 'Escape') closeProjectModal();
                        return;
                    }

                    // Determine which list is active
                    let activeData;
                    if (currentDataSource === 'booster') {
                        activeData = boosterProjectsData;
                    } else if (currentDataSource === 'nasa') {
                        activeData = nasaProjectsData;
                    } else {
                        activeData = mainProjectsData;
                    }

                    switch (event.key) {
                        case 'Escape': closeProjectModal(); break;
                        case 'ArrowRight':
                            if (currentProjectIndex !== -1 && currentProjectIndex < activeData.length - 1) {
                                openProjectModal(currentProjectIndex + 1, currentDataSource);
                            }
                            break;
                        case 'ArrowLeft':
                            if (currentProjectIndex !== -1 && currentProjectIndex > 0) {
                                openProjectModal(currentProjectIndex - 1, currentDataSource);
                            }
                            break;
                    }
                } else if (contactModal.style.display === 'flex' && event.key === 'Escape') {
                    contactModal.style.display = 'none';
                }
            });
        });
    </script>
</body>

</html>