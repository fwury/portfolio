<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>John Derham</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&family=Special+Gothic+Expanded+One&display=swap"
        rel="stylesheet">

    <!-- Custom CSS -->
    <style>
        body {
            background-color: #000;
            color: #fff;
            font-family: 'DM Sans', sans-serif;
            margin: 0;
        }

        /* --- Hero & Nav Updates --- */
        #hero-header {
            position: relative;
            width: 100%;
            height: 100vh;
            /* Full viewport height */
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
        }

        #hero-video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 0;
        }

        /* Optional: Dark overlay to make nav/logo pop if video is bright */
        .hero-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            z-index: 1;
            pointer-events: none;
        }

        .navbar {
            padding-top: 4rem;
            padding-bottom: 4rem;
            position: relative;
            z-index: 10;
            /* Ensures Nav sits on top of video */
            width: 100%;
        }

        .navbar-brand {
            /* Text styles removed, added generic transition */
            transition: opacity 0.3s ease;
            display: flex;
            align-items: center;
        }

        .navbar-brand img {
            max-height: 50px;
            /* Adjust based on logo aspect ratio */
            width: auto;
        }

        .navbar-brand:hover {
            opacity: 0.7;
        }

        /* --- End Hero Updates --- */

        .content-wrapper {
            padding-left: 5rem;
            padding-right: 5rem;
        }

        @media (max-width: 768px) {
            .content-wrapper {
                padding-left: 1rem;
                padding-right: 1rem;
            }
        }

        /* --- Custom Contact Styling --- */
        .contact-button {
            color: #fff;
            font-family: 'DM Sans', sans-serif;
            text-decoration: none;
            background: none;
            border: none;
            font-size: 1rem;
            letter-spacing: 1px;
            padding: .5rem 1rem;
            transition: opacity 0.3s ease;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
            /* Added shadow for readability over video */
        }

        .contact-button:hover {
            opacity: 0.7;
        }

        .dropdown-toggle::after {
            vertical-align: 0.15em;
        }

        .dropdown-menu {
            background-color: #111;
            border: 1px solid #333;
            padding: 0.5rem;
            z-index: 1000;
        }

        .dropdown-item {
            color: #ccc;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            transition: background-color 0.3s ease;
        }

        .dropdown-item img {
            width: 16px;
            height: 16px;
        }

        .dropdown-item:hover,
        .dropdown-item:focus {
            color: #fff;
            background-color: #222;
        }

        #contactModal {
            display: none;
            position: fixed;
            z-index: 1100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 2rem;
        }

        #contactModal a {
            color: #fff;
            text-decoration: none;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: opacity 0.3s ease;
        }

        #contactModal a:hover {
            opacity: 0.7;
        }

        #contactModal img {
            width: 24px;
            height: 24px;
        }

        /* --- End Custom Contact Styling --- */

        .portfolio-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
            margin-top: 5rem;
        }

        @media (max-width: 768px) {
            .portfolio-grid {
                grid-template-columns: 1fr;
            }
        }

        .portfolio-item {
            position: relative;
            cursor: pointer;
        }

        .portfolio-image {
            aspect-ratio: 16 / 9;
            background-size: cover;
            background-position: center;
        }

        .portfolio-item .overlay {
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            height: 100%;
            width: 100%;
            opacity: 0;
            transition: .3s ease;
            background-color: rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        @media (hover: hover) {
            .portfolio-item:hover .overlay {
                opacity: 1;
            }
        }

        .project-name {
            font-family: 'Special Gothic Expanded One', sans-serif;
            color: white;
            font-size: 1.25rem;
            padding: 1rem;
        }

        /* --- Modal Styling (Unchanged) --- */
        .modal {
            display: none;
            position: fixed;
            z-index: 1050;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: rgba(0, 0, 0, 0.85);
            align-items: center;
            justify-content: center;
        }

        .modal.is-open {
            display: flex;
        }

        .modal-content {
            position: relative;
            width: 90%;
            max-width: 1200px;
            max-height: 80vh;
            display: flex;
            background-color: transparent;
            border: none;
            pointer-events: none;
        }

        .carousel-container,
        .description-container {
            pointer-events: auto;
        }

        .modal-body {
            display: flex;
            width: 100%;
            height: 100%;
            padding: 0;
            align-items: flex-start;
        }

        .close-button {
            position: absolute;
            top: 2rem;
            right: 2rem;
            background: none;
            border: none;
            padding: 0;
            cursor: pointer;
            z-index: 1060;
        }

        .close-button img {
            width: 40px;
            height: 40px;
            display: block;
            transition: opacity 0.3s ease;
        }

        .close-button:hover img {
            opacity: 0.7;
        }

        .carousel-container {
            width: 75%;
            position: relative;
            aspect-ratio: 16 / 9;
        }

        .social-media-icon {
            width: 30px;
            height: 30px;
        }

        #projectCarousel,
        .carousel-inner,
        .carousel-item {
            height: 100%;
        }

        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        .description-container {
            width: 25%;
            max-height: 80vh;
            padding: 0 2rem 1rem 2rem;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.5);
            /* Slight bg for readability if overlapping */
        }

        #projectTitle {
            font-family: 'Special Gothic Expanded One', sans-serif;
            font-size: 1.8rem;
            font-weight: bold;
            padding-bottom: 0.75rem;
            margin-top: 0;
            margin-bottom: 1rem;
            border-bottom: 1px solid #555;
        }

        #projectDescription {
            font-size: 0.9rem;
            line-height: 1.7;
            color: #ccc;
        }

        .carousel-control-prev,
        .carousel-control-next {
            width: 5%;
            height: 50%;
            top: 25%;
        }

        .carousel-indicators {
            position: absolute;
            bottom: -50px;
        }

        @media (max-width: 992px) {
            .modal-body {
                flex-direction: column;
                align-items: center;
                justify-content: center;
            }

            .carousel-container {
                width: 100%;
            }

            .description-container {
                display: none;
            }

            .carousel-indicators {
                bottom: -40px;
            }

            .close-button {
                top: 1rem;
                right: 1rem;
            }
        }
    </style>
</head>

<body>

    <!-- Header Section with Video and Nav -->
    <header id="hero-header">
        <!-- Background Video -->
        <video id="hero-video" autoplay loop muted playsinline>
            <source src="img/pers6na.mp4" type="video/mp4">
        </video>

        <!-- Overlay to darken video for menu visibility -->
        <div class="hero-overlay"></div>

        <!-- Navigation -->
        <nav class="navbar navbar-dark bg-transparent">
            <div class="container-fluid content-wrapper">
                <!-- Logo Image -->
                <a class="navbar-brand" href="#">
                    <img src="img/logo.png" alt="John Derham">
                </a>

                <!-- Desktop Dropdown -->
                <div class="dropdown d-none d-lg-block">
                    <button class="btn dropdown-toggle contact-button" type="button" id="contactDropdown"
                        data-bs-toggle="dropdown" aria-expanded="false">
                        CONTACT ME
                    </button>
                    <ul class="dropdown-menu dropdown-menu-dark dropdown-menu-end" aria-labelledby="contactDropdown">
                        <li>
                            <a class="dropdown-item" href="https://www.instagram.com/johndrhm" target="_blank">
                                <img src="img/instagram.png" alt="Instagram">
                                <span>Instagram</span>
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="https://www.tiktok.com/@johndrhm" target="_blank">
                                <img src="img/tiktok.png" alt="TikTok">
                                <span>TikTok</span>
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="mailto:johnderhamtoronto@gmail.com">
                                <img src="img/email.png" alt="Email">
                                <span>johnderhamtoronto@gmail.com</span>
                            </a>
                        </li>
                    </ul>
                </div>

                <!-- Mobile Contact Button -->
                <button id="mobileContactButton" class="btn contact-button d-lg-none" type="button">
                    CONTACT ME
                </button>
            </div>
        </nav>
    </header>

    <main class="content-wrapper mb-5">
        <div id="portfolio-grid" class="portfolio-grid">
            <!-- Portfolio items will be injected here -->
        </div>
    </main>

    <!-- Project Viewer Modal -->
    <div id="projectModal" class="modal">
        <button id="closeProjectModalButton" class="close-button">
            <img src="img/x.png" alt="Close">
        </button>
        <div class="modal-content">
            <div class="modal-body">
                <div class="carousel-container">
                    <div id="projectCarousel" class="carousel slide h-100" data-bs-interval="false">
                        <div class="carousel-inner h-100">
                            <!-- Carousel items will be injected here -->
                        </div>
                        <button class="carousel-control-prev" type="button" data-bs-target="#projectCarousel"
                            data-bs-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Previous</span>
                        </button>
                        <button class="carousel-control-next" type="button" data-bs-target="#projectCarousel"
                            data-bs-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Next</span>
                        </button>
                        <div class="carousel-indicators">
                            <!-- Indicators will be injected here -->
                        </div>
                    </div>
                </div>
                <div class="description-container">
                    <h3 id="projectTitle"></h3>
                    <p id="projectDescription" style="white-space: pre-wrap;"></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Contact Modal -->
    <div id="contactModal">
        <button id="closeContactModalButton" class="close-button">
            <img src="img/x.png" alt="Close">
        </button>
        <a href="https://www.instagram.com/johndrhm" target="_blank">
            <img src="img/instagram.png" alt="Instagram">
            <span>Instagram</span>
        </a>
        <a href="https://www.tiktok.com/@johndrhm" target="_blank">
            <img src="img/tiktok.png" alt="TikTok">
            <span>TikTok</span>
        </a>
        <a href="mailto:johnderhamtoronto@gmail.com">
            <img src="img/email.png" alt="Email">
            <span>johnderhamtoronto@gmail.com</span>
        </a>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Project Modal Elements
            const portfolioGrid = document.getElementById('portfolio-grid');
            const projectModal = document.getElementById('projectModal');
            const closeProjectModalButton = document.getElementById('closeProjectModalButton');
            const projectTitle = document.getElementById('projectTitle');
            const projectDescription = document.getElementById('projectDescription');
            const carouselInner = document.querySelector('#projectCarousel .carousel-inner');
            const carouselIndicators = document.querySelector('#projectCarousel .carousel-indicators');
            const projectCarouselElement = document.getElementById('projectCarousel');
            const carousel = bootstrap.Carousel.getOrCreateInstance(projectCarouselElement);

            // Contact Modal Elements
            const contactModal = document.getElementById('contactModal');
            const mobileContactButton = document.getElementById('mobileContactButton');
            const closeContactModalButton = document.getElementById('closeContactModalButton');

            let projectsData = [];
            let currentProjectIndex = -1;

            // --- Project Data Handling ---
            function parseProjectsTxt(text) {
                const projects = [];
                const projectBlocks = text.split(/^\s*---\s*$/m).filter(block => block.trim() !== '');

                projectBlocks.forEach(block => {
                    const lines = block.trim().split('\n');
                    const project = { name: '', thumbnail: '', vimeo_links: [], description: '' };
                    let currentKey = null;
                    let descriptionLines = [];
                    lines.forEach(line => {
                        const nameMatch = line.match(/^name:\s*(.*)/);
                        const thumbnailMatch = line.match(/^thumbnail:\s*(.*)/);
                        const vimeoMatch = line.match(/^vimeo_links:/);
                        const descriptionMatch = line.match(/^description:/);
                        if (nameMatch) { project.name = nameMatch[1].trim(); currentKey = null; }
                        else if (thumbnailMatch) { project.thumbnail = thumbnailMatch[1].trim(); currentKey = null; }
                        else if (vimeoMatch) { currentKey = 'vimeo_links'; }
                        else if (descriptionMatch) { currentKey = 'description'; }
                        else if (currentKey) {
                            if (currentKey === 'vimeo_links' && line.trim()) { project.vimeo_links.push(line.trim()); }
                            else if (currentKey === 'description') { descriptionLines.push(line); }
                        }
                    });
                    project.description = descriptionLines.join('\n');
                    projects.push(project);
                });
                return projects;
            }

            async function loadProjects() {
                try {
                    const response = await fetch('projects.txt');
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    const textData = await response.text();
                    projectsData = parseProjectsTxt(textData);
                    renderPortfolioGrid(projectsData);
                } catch (error) {
                    console.error("Could not load or parse projects.txt:", error);
                }
            }
            loadProjects();

            // --- UI Rendering and Modal Logic ---
            function renderPortfolioGrid(projects) {
                portfolioGrid.innerHTML = '';
                projects.forEach((project, index) => {
                    const item = document.createElement('div');
                    item.className = 'portfolio-item';
                    item.dataset.index = index;
                    item.innerHTML = `<div class="portfolio-image" style="background-image: url('${project.thumbnail}')"></div><div class="overlay"><div class="project-name">${project.name}</div></div>`;
                    item.addEventListener('click', () => openProjectModal(index));
                    portfolioGrid.appendChild(item);
                });
            }

            function openProjectModal(index) {
                currentProjectIndex = index;
                const project = projectsData[index];
                projectTitle.textContent = project.name;
                projectDescription.textContent = project.description;
                carouselInner.innerHTML = '';
                carouselIndicators.innerHTML = '';
                project.vimeo_links.forEach((link, i) => {
                    const carouselItem = document.createElement('div');
                    carouselItem.className = `carousel-item ${i === 0 ? 'active' : ''}`;
                    carouselItem.innerHTML = `<iframe src="${link}" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen></iframe>`;
                    carouselInner.appendChild(carouselItem);
                    const indicator = document.createElement('button');
                    indicator.type = 'button';
                    indicator.dataset.bsTarget = '#projectCarousel';
                    indicator.dataset.bsSlideTo = i;
                    if (i === 0) indicator.classList.add('active');
                    carouselIndicators.appendChild(indicator);
                });
                carousel.to(0);
                projectModal.classList.add('is-open');
            }

            function closeProjectModal() {
                projectModal.classList.remove('is-open');
                const iframes = carouselInner.querySelectorAll('iframe');
                iframes.forEach(iframe => {
                    const src = iframe.src;
                    iframe.src = src;
                });
            }

            // Event Listeners for Project Modal
            closeProjectModalButton.addEventListener('click', closeProjectModal);
            projectModal.addEventListener('click', function (event) {
                if (event.target === projectModal) {
                    closeProjectModal();
                }
            });

            // Event Listeners for Contact Modal
            mobileContactButton.addEventListener('click', () => { contactModal.style.display = 'flex'; });
            closeContactModalButton.addEventListener('click', () => { contactModal.style.display = 'none'; });

            // Keyboard navigation
            document.addEventListener('keydown', function (event) {
                if (projectModal.classList.contains('is-open')) {
                    switch (event.key) {
                        case 'Escape': closeProjectModal(); break;
                        case 'ArrowRight':
                            if (currentProjectIndex < projectsData.length - 1) openProjectModal(currentProjectIndex + 1);
                            break;
                        case 'ArrowLeft':
                            if (currentProjectIndex > 0) openProjectModal(currentProjectIndex - 1);
                            break;
                    }
                } else if (contactModal.style.display === 'flex' && event.key === 'Escape') {
                    contactModal.style.display = 'none';
                }
            });
        });
    </script>
</body>

</html>
